(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{267:function(s,a,e){"use strict";e.r(a);var n=e(38),t=Object(n.a)({},function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"firewall的规则设置与命令-白名单设置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#firewall的规则设置与命令-白名单设置","aria-hidden":"true"}},[s._v("#")]),s._v(" firewall的规则设置与命令(白名单设置)")]),s._v(" "),e("h2",{attrs:{id:"一-设置firewall规则"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-设置firewall规则","aria-hidden":"true"}},[s._v("#")]),s._v(" 一. 设置firewall规则")]),s._v(" "),e("p",[s._v("例1：对外暴露8080端口")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("firewall-cmd --permanent --add-port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/tcp\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("例2：使mysql服务的3306端口只允许192.168.1.1/24网段的服务器能访问")]),s._v(" "),e("h3",{attrs:{id:"添加规则"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#添加规则","aria-hidden":"true"}},[s._v("#")]),s._v(" 添加规则")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("firewall-cmd --permanent --add-rich-rule"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rule family="')]),s._v("ipv4"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('" source address="')]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.1/24"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('" port protocol="')]),s._v("tcp"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('" port="')]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('" accept"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h4",{attrs:{id:"reload使生效"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#reload使生效","aria-hidden":"true"}},[s._v("#")]),s._v(" reload使生效")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("firewall-cmd --reload\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("例3：端口转发，将到本机的3306端口的访问转发到192.168.1.1服务器的3306端口")]),s._v(" "),e("h3",{attrs:{id:"开启伪装ip"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开启伪装ip","aria-hidden":"true"}},[s._v("#")]),s._v(" 开启伪装IP")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("firewall-cmd --permanent --add-masquerade\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"配置端口转发"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置端口转发","aria-hidden":"true"}},[s._v("#")]),s._v(" 配置端口转发")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("firewall-cmd --permanent --add-forward-port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(":proto"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp:toaddr"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.2:toport"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("13306")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("注意：如果不开启伪装IP，端口转发会失败；其次，要确保源服务器上的端口（3306）和目标服务器上的端口（13306）是开启的。")]),s._v(" "),e("h2",{attrs:{id:"二-firewall命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-firewall命令","aria-hidden":"true"}},[s._v("#")]),s._v(" 二. firewall命令")]),s._v(" "),e("ol",[e("li",[s._v("启动, 停止, 重启firewalld")])]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止")]),s._v("\nsystemctl stop firewalld.service \n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动")]),s._v("\nsystemctl start firewalld.service \n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启")]),s._v("\nsystemctl restart firewalld.service\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看状态： ")]),s._v("\nsystemctl status firewalld \n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁止firewall开机启动")]),s._v("\nsystemctl disable firewalld\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置开机启用防火墙：")]),s._v("\nsystemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" firewalld.service\n \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("查看firewall规则与状态")])]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看默认防火墙状态（关闭后显示notrunning，开启后显示running）")]),s._v("\nfirewall-cmd --state              \n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看防火墙规则（只显示/etc/firewalld/zones/public.xml中防火墙策略）")]),s._v("\nfirewall-cmd --list-all           \n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有的防火墙策略（即显示/etc/firewalld/zones/下的所有策略）")]),s._v("\nfirewall-cmd --list-all-zones     \n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新加载配置文件")]),s._v("\nfirewall-cmd --reload  \n           \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("ol",{attrs:{start:"3"}},[e("li",[s._v("配置firewalld-cmd")])]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看版本")]),s._v("\nfirewall-cmd --version\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看帮助 ")]),s._v("\nfirewall-cmd --help\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示状态")]),s._v("\nfirewall-cmd --state\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有打开的端口 ")]),s._v("\nfirewall-cmd --zone"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --list-ports\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新防火墙规则")]),s._v("\nfirewall-cmd --reload\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看区域信息")]),s._v("\nfirewall-cmd --get-active-zones\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看指定接口所属区域")]),s._v("\nfirewall-cmd --get-zone-of-interface"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eth0\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拒绝所有包")]),s._v("\nfirewall-cmd --panic-on\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 取消拒绝状态")]),s._v("\nfirewall-cmd --panic-off\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看是否拒绝")]),s._v("\nfirewall-cmd --query-panic\n \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br")])]),e("ol",{attrs:{start:"4"}},[e("li",[s._v("那怎么开启一个端口呢")])]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加（--permanent永久生效，没有此参数重启后失效）")]),s._v("\nfirewall-cmd --zone"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --add-port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp --permanent\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新载入(修改规则后使其生效)")]),s._v("\nfirewall-cmd --reload\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看")]),s._v("\nfirewall-cmd --zone"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" public --query-port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除")]),s._v("\nfirewall-cmd --zone"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" public --remove-port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp --permanent\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("因为在/usr/lib/firewalld/services/中事先定义了ssh.xml的相应的规则")]),s._v(" "),e("ol",{attrs:{start:"5"}},[e("li",[s._v("systemctl是CentOS7的服务管理工具中主要的工具，它融合之前service和chkconfig的功能于一体。")])]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动一个服务")]),s._v("\nsystemctl start firewalld.service \n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭一个服务")]),s._v("\nsystemctl stop firewalld.service \n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示一个服务的状态")]),s._v("\nsystemctl status firewalld.service \n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在开机时启用一个服务")]),s._v("\nsystemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" firewalld.service \n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在开机时禁用一个服务")]),s._v("\nsystemctl disable firewalld.service \n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看服务是否开机启动")]),s._v("\nsystemctl is-enabled firewalld.service \n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看已启动的服务列表")]),s._v("\nsystemctl list-unit-files"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" enabled \n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看启动失败的服务列表")]),s._v("\nsystemctl --failed \n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br")])])])},[],!1,null,null,null);a.default=t.exports}}]);